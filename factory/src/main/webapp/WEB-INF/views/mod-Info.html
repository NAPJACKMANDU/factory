<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>P06_ì •ë³´ë“±ë¡</title>
    <!-- ì „ì—­ style -->
    <!-- ì§€ì—­ style -->
    <link
      rel="stylesheet"
      href="/src/main/resources/static/style/P06_mod-Info.css"
    />
  </head>
  <body>
    <!-- View -->
    <div alt="mod-container" id="globals-container">
      <!-- header -->
      <header alt="í—¤ë”">
        <!-- ë¶€ê°€ê¸°ëŠ¥ íƒ­ -->
        <nav alt="ë¶€ê°€ê¸°ëŠ¥ íƒ­">
          <div alt="a ì»¨í…Œì´ë„ˆ">
            <a href="#" style="font-size: 11.8pt">CCTVëª¨ë‹ˆí„°</a>
          </div>
          <div class="vertical-line"></div>
          <div alt="a ì»¨í…Œì´ë„ˆ">
            <a href="#" style="font-size: 11.8pt">ì•ˆì „ìˆ˜ì¹™</a>
          </div>
          <div class="vertical-line"></div>

          <div alt="a ì»¨í…Œì´ë„ˆ">
            <a href="#" style="font-size: 11.8pt">ì—°ë½ë§</a>
          </div>
        </nav>
      </header>

      <main alt="ì •ë³´ ë“±ë¡ ìˆ˜ì • ì»¨í…Œì´ë„ˆ">
        <!-- íšŒì› ì •ë³´ ë³€ê²½ -->
        <div class="mod-container">
          <h2>ë‚´ ì •ë³´ ë³€ê²½</h2>
          <form id="joinForm" action="/joinForm" method="post">
            <div class="form-group">
              <label for="name">ì´ë¦„</label>
              <input
                type="text"
                id="name"
                name="name"
                placeholder="ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”"
                required
              />
            </div>

            <div class="form-group">
              <label for="phone">ì „í™”ë²ˆí˜¸</label>
              <input
                type="text"
                id="phone"
                name="phone"
                placeholder="01012345678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”"
                required
              />
            </div>
            <div class="form-group" id="inputState">
              <label for="companyName">íšŒì‚¬ ëª…</label>
              <select id="companyName" name="companyIdx" required>
                <option value="" disabled selected>
                  íšŒì‚¬ ëª…ì„ ì„ íƒí•´ ì£¼ì„¸ìš”
                </option>
              </select>
            </div>
            <div class="role-selection">
              <input type="radio" id="admin" name="role" value="ê´€ë¦¬ì	" />
              <label for="admin" class="role-option">ê´€ë¦¬ì</label>
              <input
                type="radio"
                id="user"
                name="role"
                value="ì¼ë°˜ ì‚¬ìš©ì"
                checked
              />
              <label for="user" class="role-option">ì¼ë°˜ ì‚¬ìš©ì</label>
            </div>
            <button type="submit">ê°€ì…í•˜ê¸°</button>
          </form>
          <footer>
            <p>ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="/login">ë¡œê·¸ì¸</a></p>
          </footer>
        </div>

        <!-- ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ -->

        <!-- ì•ˆì „ì‚¬ê³  ëŒ€ì‘ì±… ë“±ë¡ -->
        <div class="mod-container">
          <h2>ì•ˆì „ ì‚¬ê³  ëŒ€ì‘ì±…</h2>
          <!-- âœ… ìë£Œë“±ë¡ âœ… -->
          <!--  ğŸ“¢ ì¼ë°˜ ì•ˆì „ìˆ˜ì¹™ ë“±ë¡ -->
          <form id="#_Form" action="#" method="post">
            <div class="form-group">
              <label for="#">ì•ˆì „ìˆ˜ì¹™</label>
              <input type="file" id="#" name="#" />
              <!-- ë²„íŠ¼ id ìˆ˜ì • ì˜ˆì • -->
              <button type="button" id="idCheckButton">pdf ë¯¸ë¦¬ë³´ê¸°</button>
            </div>
          </form>
          <!-- ğŸ“¢ ìƒí™©ë³„ ë¹„ìƒ ëŒ€ì‘ ì ˆì°¨ ë“±ë¡ -->
          <form id="emergencyForm" action="#" method="post">
            <div class="form-group">
              <label for="emergencySelect">ë¹„ìƒ ì‹œ ì´ˆë™ ëŒ€ì‘ ì ˆì°¨</label>
              <select id="emergencySelect" name="emergencyType" required>
                <option value="" disabled selected>ë¹„ìƒ ìƒí™© ì„ íƒ</option>
                <option value="fire">í™”ì¬</option>
                <option value="earthquake">ë‚™ìƒ</option>
                <option value="flood">ì‹¤ì‹ </option>
              </select>
              <input type="file" id="emergencyFile" name="emergencyFile" />
              <button type="button" id="previewButton">pdf ë¯¸ë¦¬ë³´ê¸°</button>
              <button type="button" id="addEmergencyButton">ìë£Œ ì¶”ê°€</button>
            </div>
          </form>

          <!-- âœ… ì¶”ê°€ëœ ìë£Œ ë¹„ë™ê¸° ì¡°íšŒ âœ… -->
          <div id="emergencyListContainer">
            <h3>ì¶”ê°€ëœ ìë£Œ ëª©ë¡</h3>
            <ul id="emergencyList">
              <!-- ë¹„ë™ê¸°ì ìœ¼ë¡œ ì¶”ê°€ëœ ìë£Œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </ul>
          </div>
        </div>
      </main>
    </div>

    <script>
      $(document).ready(function () {
        // ë¹„ìƒ ëŒ€ì‘ ì ˆì°¨ ìë£Œ ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $("#addEmergencyButton").on("click", function () {
          const selectedType = $("#emergencySelect").val();
          const fileInput = $("#emergencyFile");
          const file = fileInput.prop("files")[0];

          if (!selectedType || !file) {
            alert("ìƒí™©ì„ ì„ íƒí•˜ê³  íŒŒì¼ì„ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.");
            return;
          }

          // FormDataë¥¼ ì‚¬ìš©í•´ ë¹„ë™ê¸°ì ìœ¼ë¡œ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
          const formData = new FormData();
          formData.append("emergencyType", selectedType);
          formData.append("emergencyFile", file);

          $.ajax({
            url: "/addEmergencyData", // ì„œë²„ ì—…ë¡œë“œ API ê²½ë¡œ
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
              // ì„œë²„ ì‘ë‹µ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëª©ë¡ ì—…ë°ì´íŠ¸
              appendEmergencyData(response);
              alert("ìë£Œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
            },
            error: function () {
              alert("ìë£Œ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
            },
          });
        });

        // ìë£Œ ëª©ë¡ì— ìƒˆ í•­ëª© ì¶”ê°€
        function appendEmergencyData(data) {
          const listItem = `
      <li>
        <strong>ìƒí™©:</strong> ${data.type}
        <a href="${data.fileUrl}" target="_blank">íŒŒì¼ ë‹¤ìš´ë¡œë“œ</a>
      </li>
    `;
          $("#emergencyList").append(listItem);
        }
      });
    </script>
    <!-- jQuery -->
    <script src="/src/main/resources/static/js/jquery-3.6.0.js"></script>
    <!-- scripts -->
    <script src="/src/main/resources/static/js/P06_mod-Info.js"></script>
  </body>
</html>
